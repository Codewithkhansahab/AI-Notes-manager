name: Test Slack Notifications

on:
  workflow_dispatch:
    inputs:
      simulate:
        description: "success or fail"
        required: true
        default: "success"
        type: choice
        options:
          - success
          - fail

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Simulate step result
        id: simulate
        run: |
          if [ "${{ github.event.inputs.simulate }}" = "fail" ]; then
            echo "Simulating failure..."
            exit 1
          else
            echo "Simulating success..."
          fi

      # ------------------------------
      # üü¢ Slack Success (if simulated success)
      # ------------------------------
      - name: Slack Success Notification
        if: success()
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data '{
              "channel": "'"${{ secrets.SLACK_CHANNEL_ID }}"'",
              "text": "‚úÖ Test SUCCESS triggered by ${{ github.actor }} \n<${{ github.run_url }}|View Run>"
            }' \
            https://slack.com/api/chat.postMessage

      # ------------------------------
      # üî¥ Slack Failure (if simulated failure)
      # ------------------------------
      - name: Slack Failure Notification
        if: failure()
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data '{
              "channel": "'"${{ secrets.SLACK_CHANNEL_ID }}"'",
              "text": "‚ùå Test FAILURE triggered by ${{ github.actor }} \n<${{ github.run_url }}|View Run>"
            }' \
            https://slack.com/api/chat.postMessage
