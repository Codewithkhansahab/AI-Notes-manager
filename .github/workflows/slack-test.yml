name: Test Slack Notifications

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Step that may succeed or fail
        id: random
        run: |
          echo "Testing real success/failure..."
          # Randomly fail or succeed to test both paths
          if [ $((RANDOM % 2)) -eq 0 ]; then
            echo "Simulating SUCCESS!"
          else
            echo "Simulating FAILURE!"
            exit 1
          fi

      # üü¢ Slack Notification for SUCCESS
      - name: Slack Success Notification
        if: success()
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data '{
              "channel": "'"${{ secrets.SLACK_CHANNEL_ID }}"'",
              "text": "‚úÖ REAL SUCCESS TEST - Run by *${{ github.actor }}* \n<${{ github.run_url }}|View Run>"
            }' \
            https://slack.com/api/chat.postMessage

      # üî¥ Slack Notification for FAILURE
      - name: Slack Failure Notification
        if: failure()
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data '{
              "channel": "'"${{ secrets.SLACK_CHANNEL_ID }}"'",
              "text": "‚ùå REAL FAILURE TEST - Run by *${{ github.actor }}* \n<${{ github.run_url }}|View Run>"
            }' \
            https://slack.com/api/chat.postMessage
